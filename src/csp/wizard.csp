<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <!-- End Required meta tags -->
  <!-- Begin SEO tag -->
  <title>RAD | IRIS Rapid Application Development</title>
  <meta property="og:title" content="RAD - IRIS Rapid Application Development" />
  <meta name="author" content="Henrique Dias" />
  <meta property="og:locale" content="en_US" />
  <meta name="description" content="Project & Task Management using InterSystems IRIS and Bootstrap 4" />
  <meta property="og:description" content="Project & Task Management using InterSystems IRIS and Bootstrap 4" />
  <link rel="canonical" href="https://github.com/diashenrique/" />
  <meta property="og:url" content="https://github.com/diashenrique/" />
  <meta property="og:site_name" content="RAD, IRIS Rapid Application Development" />
  <script type="application/ld+json">
    {
      "name": "RAD - InterSystems IRIS RAD",
      "description": "Rapid Application Development"
    }
  </script>
  <!-- End SEO tag -->
  <!-- FAVICONS -->
  <link rel="apple-touch-icon" sizes="144x144" href="resources/img/forms2.svg" />
  <link rel="shortcut icon" href="resources/img/forms2.svg" />
  <meta name="theme-color" content="#3063A0" />
  <!-- End FAVICONS -->
  <!-- GOOGLE FONT -->
  <link href="https://fonts.googleapis.com/css?family=Fira+Sans:400,500,600" rel="stylesheet" />
  <!-- End GOOGLE FONT -->
  <!-- BEGIN PLUGINS STYLES -->
  <link rel="stylesheet" href="resources/plugins/looper/assets/vendor/open-iconic/css/open-iconic-bootstrap.min.css" />
  <link rel="stylesheet" href="resources/plugins/looper/assets/vendor/fontawesome/css/all.css" />
  <!-- END PLUGINS STYLES -->
  <!-- BEGIN THEME STYLES -->
  <link rel="stylesheet" href="resources/plugins/looper/assets/stylesheets/theme.min.css" data-skin="default" />
  <link rel="stylesheet" href="resources/plugins/looper/assets/stylesheets/theme-dark.min.css" data-skin="dark" />
  <link rel="stylesheet" href="resources/plugins/looper/assets/stylesheets/custom.css" />
  <!-- DevExtreme themes -->
  <link rel="stylesheet" type="text/css" href="resources/plugins/extreme20.1.4/css/dx.common.css" />
  <link rel="dx-theme" data-theme="generic.light" href="resources/plugins/extreme20.1.4/css/dx.light.css" data-active="false" />
  <link rel="dx-theme" data-theme="generic.dark" href="resources/plugins/extreme20.1.4/css/dx.generic.custom-dark.css" data-active="false" />
  <!-- Disable unused skin immediately -->
  <script>
    var skin = localStorage.getItem("skin") || "default";
    var unusedLink = document.querySelector('link[data-skin]:not([data-skin="' + skin + '"])');
    unusedLink.setAttribute("rel", "");
    unusedLink.setAttribute("disabled", true);
  </script>
  <!-- END THEME STYLES -->
</head>

<body>
  <!-- .app -->
  <div class="app has-fullwidth">
    <header class="app-header app-header-dark">
      <!-- .top-bar -->
      <div class="top-bar">
        <!-- .top-bar-brand -->
        <div class="top-bar-brand bg-transparent">
          <!-- toggle menu -->
          <button class="hamburger hamburger-squeeze mr-2" type="button" data-toggle="aside" aria-label="toggle menu">
            <span class="hamburger-box">
              <span class="hamburger-inner"></span>
            </span>
          </button>
          <!-- /toggle menu -->
        </div>
        <!-- .top-bar-list -->
        <div class="top-bar-list">
          <!-- .top-bar-item -->
          <div class="top-bar-item px-2 d-md-none d-lg-none d-xl-none">
            <!-- toggle menu -->
            <button class="hamburger hamburger-squeeze" type="button" data-toggle="aside" aria-label="Menu">
              <span class="hamburger-box">
                <span class="hamburger-inner"></span>
              </span>
            </button> <!-- /toggle menu -->
          </div><!-- /.top-bar-item -->
        </div>
        <!-- /.top-bar-brand -->
      </div>
      <!-- /.top-bar -->
    </header>
    <!-- /.app-header -->
    <!-- .app-aside -->
    <aside class="app-aside app-aside-light">
      <!-- .aside-content -->
      <div class="aside-content">
        <!-- .aside-menu -->
        <div class="aside-menu overflow-hidden">
          <!-- .stacked-menu -->
          <nav id="stacked-menu" class="stacked-menu">
            <!-- .menu -->
            <ul class="menu">
              <!-- .menu-item -->
              <li class="menu-item">
                <a href="http://localhost:52773/restforms2-ui/index.html#/" class="menu-link">
                  <span class="menu-icon fas fa-home"></span>
                  <span class="menu-text">RESTForms2</span>
                </a>
              </li>
              <li class="menu-item">
                <a href="rad.html" class="menu-link">
                  <span class="menu-icon far fa-edit"></span>
                  <span class="menu-text">CRUD Extreme</span>
                </a>
              </li>
              <li class="menu-item">
                <a href="#" class="menu-link">
                  <span class="menu-icon fas fa-table"></span>
                  <span class="menu-text">Create Class</span>
                </a>
              </li>
              <li class="menu-item has-active">
                <a href="wizard.csp" class="menu-link">
                  <span class="menu-icon fas fa-cubes"></span>
                  <span class="menu-text">Import Wizard</span>
                </a>
              </li>
              <li class="menu-item">
                <a href="../../dsw/index.html#/IRISAPP" class="menu-link">
                  <span class="menu-icon fas fa-tachometer-alt"></span>
                  <span class="menu-text">DSW Dashboard</span>
                </a>
              </li>
              <li class="menu-item">
                <a href="#" class="menu-link">
                  <span class="menu-icon fas fa-atom"></span>
                  <span class="menu-text">IntegratedML</span>
                </a>
              </li>
              <li class="menu-item">
                <a href="javascript:doLogout()" class="menu-link">
                  <span class="menu-icon fas fa-sign-out-alt"></span>
                  <span class="menu-text">Logout</span>
                </a>
              </li>
              <!-- /.menu-item -->
            </ul>
            <!-- /.menu-item -->
          </nav>
          <!-- /.stacked-menu -->
        </div>
        <!-- /.aside-menu -->
        <!-- Skin changer -->
        <footer class="aside-footer border-top p-3">
          <button class="btn btn-light btn-block text-primary" data-toggle="skin">Night mode <i class="fas fa-moon ml-1"></i></button>
        </footer>
        <!-- /Skin changer -->
      </div>
      <!-- /.aside-content -->
    </aside>
    <!-- /.app-aside -->
    <!-- .app-main -->
    <main class="app-main">
      <!-- .wrapper -->
      <div class="wrapper">
        <!-- .page -->
        <div class="page">
          <!-- .page-inner -->
          <div class="page-inner page-inner-fill">
            <!-- .page-navs -->
            <header class="page-navs shadow-sm pr-3">
              <!-- .btn-account -->
              <div class="has-badge">
                <span>
                  <img src="resources/img/wizard.png" width="32" height="32">
                </span>
              </div>
              <div class="account-summary" style="margin-left:5px">
                <h1 class="card-title"> Import Wizard </h1>
                <h6 class="card-subtitle text-muted"> CSV Import Assistant with optional cube creation and generating sample dashboard  </h6>
              </div>
              <!-- /.btn-account -->
            </header>
            <!-- /.page-navs -->
            <!-- .page-section -->
            <div class="page-section">
              <div class="section-block">
                <div class="col-lg-12">
                  <!-- .card -->
                  <div class="card">
                    <!-- .card-body -->
                    <div class="card-body">
                      <h4 class="card-title"> Import Definitions</h4>
                      <form enctype="multipart/form-data" method="post" id="fileUploadForm" action="analytics.csp">
                        <!-- .form-row -->
                        <div class="form-row">
                          <div class="input-group col-md-6 mb-2">
                            <input type="file" class="form-control" name="FileStream" id="file" required="" accept=".csv">
                            <label class="input-group-text" for="file">Upload</label>
                          </div>
                        </div>
                        <div class="form-row">
                          <div class="col-md-2 mb-2">
                            <label for="separator">Separator</label>
                            <input type="text" class="form-control" id="separator" name="separator" placeholder='default separator is ","'>
                          </div>
                        </div>
                        <hr class="mt-3">
                        <div class="form-row">
                          <div class="col-md-12 mb-4">
                            <label for="className">Class Name</label>
                            <input type="text" class="form-control" id="className" name="className" required="">
                          </div>
                        </div>
                        <hr class="mt-2">
                        <div class="form-row">
                          <!-- .form-group -->
                          <div class="form-group">
                            <!-- .custom-control -->
                            <div class="custom-control custom-checkbox">
                              <input type="checkbox" id="createCube" name="createCube" class="custom-control-input" data-parsley-group="createCube">
                              <label class="custom-control-label" for="createCube">Should I create a cube for this class?</label>
                            </div><!-- /.custom-control -->
                          </div><!-- /.form-group -->
                        </div>  

                        <div class="form-row">
                          <!-- grid column -->
                          <div class="col-md-12 mb-4">
                            <label for="cubeName">Cube Name</label>
                            <input type="text" class="form-control" id="cubeName" name="cubeName">
                          </div><!-- /grid column -->
                        </div><!-- /.form-row -->

                        <div class="form-row">
                          <!-- .form-group -->
                          <div class="form-group">
                            <!-- .custom-control -->
                            <div class="custom-control custom-checkbox">
                              <input type="checkbox" id="generateDash" name="generateDash" class="custom-control-input" data-parsley-group="generateDash">
                              <label class="custom-control-label" for="generateDash">Generate a sample dashboard?</label>
                            </div><!-- /.custom-control -->
                          </div><!-- /.form-group -->
                        </div>

                        <div class="d-flex">
                          <button type="submit" id="btnUpload" class="submit btn btn-primary ml-auto" data-validate="agreement">Upload</button>
                        </div>
                      </form><!-- /form .needs-validation -->

                      <!-- As form is submitted to this page look to see if we have the stream in the %request object -->
                      <csp:if condition='($data(%request.MimeData("FileStream",1)))'>
                        <hr><br>
                        Submitted filename: <b>#(..EscapeHTML(%request.MimeData("FileStream",1).FileName))#</b><br>
                        Size of file: <b>#(..EscapeHTML(%request.MimeData("FileStream",1).Size))#</b><br>
                        Mime Section: <b>#(..EscapeHTML(%request.MimeData("FileStream",1).MimeSection))#</b><br>
                        Type of stream: <b>#(..EscapeHTML($classname(%request.MimeData("FileStream",1))))#</b><br>
                        Content Type: <b>#(..EscapeHTML(%request.MimeData("FileStream",1).ContentType))#</b><br>
                        Class Name : <b>#(..EscapeHTML(%request.Data("className",1)))#</b><br>
                        Cube Name : <b>#(..EscapeHTML(%request.Data("cubeName",1)))#</b><br>

                        <script language="Cache" runat="server">
                          new stream, tSeparator, tSourceClass, tCreateCube, tCubeClass, tCubeName, tGenerateDash
                          set (stream, tSeparator, tSourceClass, tCreateCube, tCubeClass, tCubeName, tGenerateDash)=""

                          set stream = %request.GetMimeData("FileStream")
                          set tSeparator = $get(%request.Data("separator",1))
                          if (tSeparator = "") {
                            set tSeparator = ","
                          }
                          set tSourceClass = $get(%request.Data("className",1))
                          set tCubeName = $get(%request.Data("cubeName",1))
                          set tCreateCube = $get(%request.Data("createCube",1))
                          set tGenerateDash = $get(%request.Data("generateDash",1))

                          if ('$IsObject(stream)) {
                            $$$ThrowOnError($$$ERROR(9200,"no file"))
                          } else {
                            $$$ThrowOnError(##class(community.csvgen).StreamToFile(stream,.filename))
                            $$$ThrowOnError(##class(community.csvgen).Generate(filename,tSeparator,tSourceClass))
                          }

                          if (tCreateCube'="") {
                            set tCubeClass=tSourceClass_"Cube"
                            set st = ##class(%DeepSee.WizardUtils).%GenerateCubeDefinition(tSourceClass,tCubeName,tCubeClass)

                            if $$$ISOK(st) {
                              set st = $System.OBJ.Compile(tCubeClass,"fck /displayerror=0 /displaylog=0")
                              
                              if $$$ISOK(st) {
                                set st = ##class(%DeepSee.Utils).%BuildCube(tCubeName,,0)

                                if $$$ISOK(st) {
                                  if (tGenerateDash'="") {
                                    set st = ##class(AnalyzeThis.Generator).GenerateDash(tCubeName) 

                                    &SQL(GRANT Select ON * TO UnknownUser)
                                  }
                                }
                              }
                            }
                          }
                        </script>
                        </ul>
                      </csp:if>

                    </div><!-- /.card-body -->
                  </div><!-- /.card -->
                </div>
              </div>
            </div>
            <!-- /.page-section -->
          </div>
          <!-- /.page-inner -->
        </div>
        <!-- /.page-inner -->
      </div>
      <!-- /.page -->
  </div>
  <!-- /.wrapper -->
  </main>
  <!-- /.app-main -->
  </div>
  <!-- /.app -->
  <!-- BEGIN BASE JS -->
  <script src="resources/plugins/looper/assets/vendor/jquery/jquery.min.js"></script>
  <script src="resources/plugins/looper/assets/vendor/bootstrap/js/popper.min.js"></script>
  <script src="resources/plugins/looper/assets/vendor/bootstrap/js/bootstrap.min.js"></script>
  <!-- END BASE JS -->
  <!-- BEGIN PLUGINS JS -->
  <script src="resources/plugins/looper/assets/vendor/pace/pace.min.js"></script>
  <script src="resources/plugins/looper/assets/vendor/stacked-menu/stacked-menu.min.js"></script>
  <script src="resources/plugins/looper/assets/vendor/perfect-scrollbar/perfect-scrollbar.min.js"></script>
  <script src="resources/plugins/looper/assets/vendor/sortablejs/Sortable.min.js"></script>
  <!-- END PLUGINS JS -->
  <!-- BEGIN THEME JS -->
  <script src="resources/plugins/looper/assets/javascript/theme.min.js"></script>
  <!-- BEGIN DevExtreme library -->
  <script type="text/javascript" src="resources/plugins/extreme20.1.4/js/dx.web.js"></script>
  <!-- END DevExtreme library -->
  <!-- BEGIN ISProject Custom -->
  <script type="text/javascript" src="resources/js/custom-theme-changer.js"></script>
  <script type="text/javascript" src="resources/js/util.js"></script>
  <script type="text/javascript" src="resources/js/restforms2.js"></script>
  <script type="text/javascript" src="resources/js/customdash2.js"></script>
  <!-- END ISProject Custom -->
</body>

</html>